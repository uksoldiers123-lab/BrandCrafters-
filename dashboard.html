<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BrandCrafters â€” Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="dashboard.css" />
  <script defer src="dashboard.js"></script>
</head>

<body class="admin-body">

<!-- ============================
   HEADER (matches main site)
=============================== -->
<header class="site-header admin-header">
  <div class="container header-inner">
    <a class="logo" href="index.html">
      <span class="logo-mark">BC</span><span>BrandCrafters</span>
    </a>

    <nav class="nav desktop-nav">
      <a href="index.html" class="nav-link">Home</a>
      <a href="pricing.html" class="nav-link">Pricing</a>
      <a href="customer-inquiry.html" class="nav-link">Customer Portal</a>
      <span id="userEmail" class="admin-email"></span>
      <button id="logoutBtn" class="btn btn-outline">Logout</button>
    </nav>

    <button class="menu-toggle" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>
  </div>

  <nav class="mobile-drawer admin-drawer" aria-hidden="true">
    <div class="drawer-header">
      <a class="logo" href="index.html">
        <span class="logo-mark">BC</span><span>BrandCrafters</span>
      </a>
      <button class="menu-close">âœ•</button>
    </div>

    <a class="drawer-link" href="index.html">Home</a>
    <a class="drawer-link" href="pricing.html">Pricing</a>
    <a class="drawer-link" href="customer-inquiry.html">Customer Portal</a>
    <a class="drawer-link highlight" href="dashboard.html">Admin Dashboard</a>
    <button class="drawer-link" id="logoutBtnMobile">Logout</button>
  </nav>

  <div class="drawer-backdrop"></div>
</header>




<!-- ============================
   SIDEBAR (Admin Only)
=============================== -->
<aside class="sidebar">
  <div class="sidebar-header">
    <div class="bc-icon">BC</div>
    <span class="sidebar-title">Admin Panel</span>
  </div>

  <nav class="sidebar-nav">
    <a href="dashboard.html" class="side-item active">ğŸ  Dashboard</a>

    <div class="side-group">
      <div class="side-label">LEADS</div>
      <a href="dashboard-leads.html" class="side-sub">ğŸ“‡ Lead List</a>
      <a href="dashboard-leads-upload.html" class="side-sub">ğŸ“¤ Upload CSV</a>
    </div>

    <div class="side-group">
      <div class="side-label">DEMOS</div>
      <a href="dashboard-demos.html" class="side-sub">ğŸŒ Demo Library</a>
      <a href="dashboard-demos.html#add" class="side-sub">â• Add Demo</a>
    </div>

    <div class="side-group">
      <div class="side-label">COMMUNICATIONS</div>
      <a href="dashboard-communications.html" class="side-sub">ğŸ“ Call Scripts</a>
      <a href="dashboard-communications.html#email" class="side-sub">âœ‰ï¸ Email Templates</a>
      <a href="dashboard-communications.html#dm" class="side-sub">ğŸ’¬ DM Templates</a>
    </div>

    <div class="side-group">
      <div class="side-label">SETTINGS</div>
      <a href="dashboard-settings.html" class="side-sub">âš™ï¸ System Settings</a>
    </div>
  </nav>
</aside>




<!-- ============================
   MAIN CONTENT
=============================== -->
<main class="main-content">
  <h1>Dashboard Overview</h1>
  <p class="subhead">Your money, leads, and project performance.</p>


  <!-- MONEY CARDS -->
  <section class="grid-3">
    <div class="card stat-card">
      <div class="stat-label">Lifetime Project Revenue</div>
      <div class="stat-value" id="lifetimeRevenue">$0.00</div>
      <p class="muted">Total one-time money from projects.</p>
    </div>

    <div class="card stat-card">
      <div class="stat-label">Active Monthly Income</div>
      <div class="stat-value" id="monthlyIncome">$0.00</div>
      <p class="muted">Maintenance fees from clients.</p>
    </div>

    <div class="card stat-card">
      <div class="stat-label">Monthly Bills</div>
      <div class="stat-value" id="monthlyBills">$0.00</div>
      <p class="muted">Tools + domain renewals + client bills.</p>
    </div>
  </section>


  <section class="grid-3">
    <div class="card stat-card">
      <div class="stat-label">Estimated Net (Monthly)</div>
      <div class="stat-value" id="monthlyNet">$0.00</div>
      <p class="muted">Maintenance minus bills.</p>
    </div>

    <div class="card stat-card">
      <div class="stat-label">Closed Won (This Month)</div>
      <div class="stat-value" id="closedWonMonth">0</div>
      <p class="muted">Sales from contractors.</p>
    </div>

    <div class="card stat-card">
      <div class="stat-label">Commission Owed</div>
      <div class="stat-value" id="commissionMonth">$0.00</div>
      <p class="muted">$50â€’$100 per sale (package based).</p>
    </div>
  </section>




  <!-- RECENT PROJECTS -->
  <h2 style="margin-top:40px;">Recent Projects</h2>
  <div class="card">
    <table class="table" id="projectsTable">
      <thead>
        <tr>
          <th>Client</th>
          <th>Total</th>
          <th>Monthly</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>




  <!-- UPCOMING BILLS -->
  <h2 style="margin-top:40px;">Upcoming Bills</h2>
  <div class="card">
    <table class="table" id="billsTable">
      <thead>
        <tr>
          <th>Bill</th>
          <th>Due</th>
          <th>Vendor</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p id="billsNote" class="muted"></p>
  </div>




  <!-- LEAD SNAPSHOT -->
  <h2 style="margin-top:40px;">Lead Snapshot</h2>
  <div class="card">
    <div class="grid-2">
      <div>
        <p class="stat-label">Status Overview</p>
        <p id="leadStatusStats" class="muted">Loadingâ€¦</p>
      </div>

      <div>
        <p class="stat-label">Top Contractors</p>
        <table class="table" id="topCallersTable">
          <thead>
            <tr><th>Caller</th><th>Closed</th><th>Commission</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

</main>




<!-- SUPABASE -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://vekoulqehexqosgwacwa.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZla291bHFlaGV4cW9zZ3dhY3dhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxNTYxNTUsImV4cCI6MjA3ODczMjE1NX0.B9gSHAb_cLCcjCzXM5FegDIKsuQwHCqAFXslfAzzrQ4";
const ADMIN_EMAIL = "srarnold216@gmail.com";

const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* AUTH GUARD */
async function guard() {
  const { data } = await client.auth.getUser();
  if (!data.user) {
    window.location.href = "dashboard-login.html";
    return;
  }
  if (data.user.email !== ADMIN_EMAIL) {
    window.location.href = "contractor-portal.html";
    return;
  }
  document.getElementById("userEmail").textContent = data.user.email;
}
guard();


function money(x){return "$"+Number(x||0).toFixed(2);}


/* LOAD DASHBOARD DATA */
async function loadAll() {
  const [onb, bills, leads] = await Promise.all([
    client.from("onboarding_submissions").select("*"),
    client.from("recurring_expenses").select("*"),
    client.from("call_leads").select("*")
  ]);

  const onboarding = onb.data || [];
  const expenses = bills.data || [];
  const calls = leads.data || [];

  // money
  let total=0, monthly=0;
  onboarding.forEach(p=>{
    total += Number(p.total_price||0);
    monthly += Number(p.monthly_fee||0);
  });

  document.getElementById("lifetimeRevenue").textContent = money(total);
  document.getElementById("monthlyIncome").textContent = money(monthly);

  let billsMonthly=0;
  expenses.forEach(b=>{
    if (b.frequency==="monthly") billsMonthly += Number(b.amount||0);
  });

  document.getElementById("monthlyBills").textContent = money(billsMonthly);
  document.getElementById("monthlyNet").textContent = money(monthly-billsMonthly);


  // recent projects
  const tbody = document.querySelector("#projectsTable tbody");
  tbody.innerHTML="";
  onboarding.slice(0,6).forEach(p=>{
    tbody.innerHTML += `
      <tr>
        <td>${p.business_name||"â€”"}</td>
        <td>${money(p.total_price)}</td>
        <td>${money(p.monthly_fee)}</td>
        <td>${p.status}</td>
      </tr>`;
  });


  // bills list
  const tb2 = document.querySelector("#billsTable tbody");
  tb2.innerHTML="";
  expenses.slice(0,6).forEach(b=>{
    tb2.innerHTML+=`
    <tr>
      <td>${b.name}</td>
      <td>${b.next_due_date||""}</td>
      <td>${b.vendor||""}</td>
      <td>${money(b.amount)}</td>
    </tr>`;
  });


  // leads stats
  const stats={};
  calls.forEach(c=> stats[c.call_status] = (stats[c.call_status]||0)+1 );
  document.getElementById("leadStatusStats").textContent =
    Object.entries(stats).map(([s,n])=>`${s}: ${n}`).join(" â€¢ ");
}

loadAll();
</script>

</body>
</html>
